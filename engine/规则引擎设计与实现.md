### 规则引擎设计与实现

#### 01.认识规则引擎

**定义**：规则引擎是一种嵌入在应用程序中的组件，实现了将业务决策从应用程序代码中分离出来，并使用预定义的语义模块编写业务决策。接受数据输入，解释业务规则，并根据业务规则做出业务决策。

**作用**：

- 解决开发人员重复编码的问题
- 业务决策与服务本身解耦，提高服务的可维护性
- 缩短开发路径，提高效率

**组成部分**:

- 数据输入，支持接受使用预定义的语义编写的规则作为策略集
- 规则理解，能够按照预先定义的词法、语法、优先级、运算符等正确理解业务规则所表达的语义
- 规则执行，根据执行时输入的参数对策略集中的规则进行正确的解释和执行。同时对规则执行过程中的数据类型进行检查，确保执行结果正确

**应用场景**：

- 风控对抗
- 活动策略运营
- 数据分析和清洗

#### 02.编译原理基本概念

规则引擎编译原理：理解 -> 执行 -> 输入输出

**理解**：

- 词法分析：把源代码字符串转换为词法单元(Token)的这个过程
- 语法分析：在词法分析的基础上识别出表达式的语法结构

> 如何识别Token？有限自动机
>
> 有限自动机就是一个状态机，它的状态数量是有限的。该状态机在任何一个状态，基于输入的字符，都能做一个确定的状态转换

**执行**：

- 抽象语法树：表达式抽象语法结构的树状表示，对于一个表达式，抽象语法树一定是唯一确定的

> 1.抽象语法树：表达式的语法结构可以用树来表示，其每个节点是一个语法单元，这个单元的构成规则就叫“语法”。每个节点还可以有下级节点
>
> 2.上下文无关语法：语言句子无需考虑上下文，就可以判断正确性。可以使用巴克斯范式来表达
>
> 3.递归下降算法：自顶向下构造语法树，不断的对Token进行语法展开，展开过程中可能遇到递归的情况

**输入输出**：

- 参数检查：验证执行的结果是否为合适的数据类型。在抽象语法树中，通常会验证某节点的子节点的数据类型是否合法
- 参数注入：在规则执行过程中，使用输入的参数值来计算语法树中的标识符节点值的过程

> 类型检查：
>
> 1.类型综合：根据子表达式的类型构造出父表达式的类型
>
> 2.编译时检查 & 运行时检查，类型检查可以发生在表达式的编译阶段，即在构造语法树的阶段；也可以发生在执行时的阶段。编译时，需要提前声明参数的类型，在构建语法树过程中进行类型检查。执行时，可以根据执行时的参数输入的值类型，在执行过程中进行类型检查

#### 03.设计一个规则引擎

#### 04.规则引擎的实现

 
